(()=>{"use strict";var t={421:function(t,e,r){var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.Carrito=void 0;const i=n(r(147));let o=new Date;const s=[];e.Carrito=class{constructor(t){this.timestamp=t}getCartById(t){let e=i.default.readFileSync("./src/componentes/carrito.txt","utf-8"),r=JSON.parse(e);try{return r.find((e=>e.id===t))?r.find((e=>e.id===t)):{error:"ID de carrito inexistente"}}catch(t){console.log(t)}}saveCart(){let t=i.default.readFileSync("./src/componentes/carrito.txt","utf-8"),e=JSON.parse(t),r={timestamp:o.toLocaleString()};if(e.length){let t=e[e.length-1].id+1;return i.default.writeFileSync("./src/componentes/carrito.txt",JSON.stringify([...e,Object.assign(Object.assign({},r),{id:t})],null,2)),{newCart:r,id:t}}return i.default.writeFileSync("./src/componentes/carrito.txt",JSON.stringify([...e,Object.assign(Object.assign({},r),{id:1})],null,2)),{newCart:r,id:1}}deleteCartByID(t){let e=i.default.readFileSync("./src/componentes/carrito.txt","utf-8"),r=JSON.parse(e);try{if(r.find((e=>e.id===t))){const e=r.filter((e=>e.id!==t));return i.default.writeFileSync("./src/componentes/carrito.txt",JSON.stringify(e,null,2)),`Carrito ID ${t} eliminado`}return"ID de Carrito es inexistente"}catch(t){console.log(t)}}deleteProductByID(t,e){let r=i.default.readFileSync("./src/componentes/carrito.txt","utf-8"),n=JSON.parse(r);if(n.find((e=>e.id===t))){const r=n.find((e=>e.id===t));let o=n.find((e=>e.id===t)).product.filter((t=>t.id!==e));const s={timestamp:r.timestamp,id:r.id,product:o},d=n.filter((e=>e.id!==t));return d.unshift(s),i.default.writeFileSync("./src/componentes/carrito.txt",JSON.stringify(d,null,2)),{message:"Producto modificado",newCart:s}}return{error:"ID de producto inexistente"}}addProductToCart(t){let e=i.default.readFileSync("./src/componentes/carrito.txt","utf-8"),r=JSON.parse(e),n=i.default.readFileSync("./src/componentes/productos.txt","utf-8"),d=JSON.parse(n),c=d.find((e=>e.id===t));const u=r[0];s.push(c);const a={message:"Producto agregado al carrito",product:c};if(r.length&&d.find((e=>e.id===t))){let t={timestamp:u.timestamp,id:u.id,product:[...u.product,c]};return i.default.writeFileSync("./src/componentes/carrito.txt",JSON.stringify([t],null,2)),a}if(d.find((e=>e.id===t))){let t={timestamp:o.toLocaleString(),id:1,product:s};return i.default.writeFileSync("./src/componentes/carrito.txt",JSON.stringify([t],null,2)),a}return"ID producto inexistente"}}},183:function(t,e,r){var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.Contenedor=void 0;const i=n(r(147));let o=new Date;e.Contenedor=class{constructor(t,e,r){this.title=t,this.price=e,this.thumbnail=r}getAll(){let t=i.default.readFileSync("./src/componentes/productos.txt","utf-8"),e=JSON.parse(t);try{return e}catch(t){return t}}save(t,e,r){let n=i.default.readFileSync("./src/componentes/productos.txt","utf-8"),s=JSON.parse(n),d={title:t,price:e,thumbnail:r,timestamp:o.toLocaleString(),stock:1};if(s.length){let t=s[s.length-1].id+1;return i.default.writeFileSync("./src/componentes/productos.txt",JSON.stringify([...s,Object.assign(Object.assign({},d),{id:t})],null,2)),{newProduct:d,id:t}}return i.default.writeFileSync("./src/componentes/productos.txt",JSON.stringify([...s,Object.assign(Object.assign({},d),{id:1})],null,2)),{newProduct:d,id:1}}getById(t){let e=i.default.readFileSync("./src/componentes/productos.txt","utf-8"),r=JSON.parse(e);try{return r.find((e=>e.id===t))?r.find((e=>e.id===t)):{error:"ID de producto inexistente"}}catch(t){console.log(t)}}upload(t,e,r,n){let o=i.default.readFileSync("./src/componentes/productos.txt","utf-8"),s=JSON.parse(o);if(s.find((e=>e.id===t))){const o={title:e,price:r,thumbnail:n,id:t},d=s.filter((e=>e.id!==t));return d.unshift(o),i.default.writeFileSync("./src/componentes/productos.txt",JSON.stringify(d,null,2)),{message:"Producto modificado",newProduct:o}}return{error:"ID de producto inexistente"}}deleteById(t){let e=i.default.readFileSync("./src/componentes/productos.txt","utf-8"),r=JSON.parse(e);try{if(r.find((e=>e.id===t))){const e=r.filter((e=>e.id!==t));return i.default.writeFileSync("./src/componentes/productos.txt",JSON.stringify(e,null,2)),`Producto ID ${t} eliminado`}return"ID de producto inexistente"}catch(t){console.log(t)}}}},607:function(t,e,r){var n=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(i,o){function s(t){try{c(n.next(t))}catch(t){o(t)}}function d(t){try{c(n.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,d)}c((n=n.apply(t,e||[])).next())}))},i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=i(r(860)),s=r(183),d=r(421),{Router:c}=o.default;r(142).config();const u=(0,o.default)(),a=c(),l=c();u.use(o.default.json()),u.use(o.default.static("public")),u.use(o.default.urlencoded({extended:!0}));const p=new s.Contenedor("",0,""),f=new d.Carrito(""),m=(t,e,r)=>{r()};a.get("/",((t,e)=>{const r=p.getAll();n(void 0,void 0,void 0,(function*(){e.json(yield r)}))})),a.get("/:id",((t,e)=>{const{id:r}=t.params;e.json(p.getById(Number(r)))})),a.post("/",m,((t,e)=>{const{title:r,price:n,thumbnail:i}=t.body,o=p.save(r,n,i);e.send(o)})),a.put("/:id",m,((t,e)=>{const{id:r}=t.params,{title:n,price:i,thumbnail:o}=t.body;e.send(p.upload(Number(r),n,i,o))})),a.delete("/:id",m,((t,e)=>{const{id:r}=t.params;e.send(p.deleteById(Number(r)))})),l.get("/:id/productos",((t,e)=>{const{id:r}=t.params;e.json(f.getCartById(Number(r)))})),l.post("/",((t,e)=>{const r=f.saveCart();e.send(r)})),l.delete("/:id",m,((t,e)=>{const{id:r}=t.params;e.send(f.deleteCartByID(Number(r)))})),l.delete("/:id/productos/:id_prod",m,((t,e)=>{const{id:r,id_prod:n}=t.params;e.send(f.deleteProductByID(Number(r),Number(n)))})),l.post("/:id/productos",((t,e)=>{const{id:r}=t.params,n=f.addProductToCart(Number(r));e.json(n)}));const y=process.env.PORT;u.use("/api/productos",a),u.use("/api/carrito",l),u.listen(y,(()=>{console.log("server is running on port 8080")}))},142:t=>{t.exports=require("dotenv")},860:t=>{t.exports=require("express")},147:t=>{t.exports=require("fs")}},e={};!function r(n){var i=e[n];if(void 0!==i)return i.exports;var o=e[n]={exports:{}};return t[n].call(o.exports,o,o.exports,r),o.exports}(607)})();